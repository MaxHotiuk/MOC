@{
    ViewData["Title"] = "Caesar Cipher";
}

<h2>Caesar Cipher</h2>

<form asp-action="Encrypt" method="post" class="mb-3">
    <input type="hidden" name="fileId" value="@ViewBag.FileId" />
    <div class="form-group">
        <label for="language">Language</label>
        <select id="language" name="language" class="form-control" required>
            <option value="English">English</option>
            <option value="Ukrainian">Ukrainian</option>
        </select>
    </div>
    <div class="form-group">
        <label for="key">Encryption Key</label>
        <input type="number" id="key" name="key" class="form-control" min="0" max="25" required />
    </div>
    <button type="submit" class="btn btn-primary">Encrypt</button>
</form>

<form asp-action="Decrypt" method="post" class="mb-3">
    <input type="hidden" name="fileId" value="@ViewBag.FileId" />
    <div class="form-group">
        <label for="language">Language</label>
        <select id="languageDecrypt" name="language" class="form-control" required>
            <option value="English">English</option>
            <option value="Ukrainian">Ukrainian</option>
        </select>
    </div>
    <div class="form-group">
        <label for="key">Decryption Key</label>
        <input type="number" id="keyDecrypt" name="key" class="form-control" min="0" max="25" required />
    </div>
    <button type="submit" class="btn btn-success">Decrypt</button>
</form>

<form asp-action="Attack" method="post" class="mb-3">
    <input type="hidden" name="fileId" value="@ViewBag.FileId" />
    <div class="form-group">
        <label for="languageAttack">Language</label>
    </div>
    <button type="submit" class="btn btn-warning">Brute-Force Attack</button>
</form>

@if (ViewBag.Key != null)
{
    <div class="alert alert-success">
        <h4>Decryption Successful</h4>
        <p>The file was decrypted using key: <strong>@ViewBag.Key</strong></p>
    </div>
}

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">
        <h4>Error</h4>
        <p>@ViewBag.Error</p>
    </div>
}

<div class="mt-5">
    <button class="btn btn-info" type="button" data-bs-toggle="collapse" data-bs-target="#fileContentCollapse" aria-expanded="false" aria-controls="fileContentCollapse">
        Show/Hide File Content
    </button>

    <div class="collapse mt-3" id="fileContentCollapse">
        <div class="card card-body">
            <h4>File Content</h4>
            <pre>@ViewBag.FileContent</pre>
        </div>
    </div>
</div>

<a asp-controller="EncryptDecrypt" asp-action="Files" class="btn btn-secondary mt-3">Back to Files</a>

@section Scripts {
    <script>
        // Update key input constraints based on selected language
        function updateKeyConstraints(languageSelect, keyInput) {
            const language = languageSelect.value;
            if (language === "English") {
                keyInput.min = 0;
                keyInput.max = 26;
            } else if (language === "Ukrainian") {
                keyInput.min = 0;
                keyInput.max = 33;
            }
        }

        // Attach event listeners to language dropdowns
        document.getElementById("language").addEventListener("change", function () {
            updateKeyConstraints(this, document.getElementById("key"));
        });

        document.getElementById("languageDecrypt").addEventListener("change", function () {
            updateKeyConstraints(this, document.getElementById("keyDecrypt"));
        });

        document.getElementById("languageAttack").addEventListener("change", function () {
            updateKeyConstraints(this, document.getElementById("keyAttack"));
        });
    </script>
}